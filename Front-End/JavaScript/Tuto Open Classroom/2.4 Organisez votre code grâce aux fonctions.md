
Notre projet avance ! Nous pouvons maintenant proposer plusieurs mots ou phrases à l’utilisateur, compter son score et l’afficher. 🚀

Pour l’instant notre code est encore relativement petit, mais il va grandir au fur et à mesure du développement. Il est donc très important de **l’organiser pour qu’il reste lisible et fonctionnel**. C’est d’autant plus important que, en tant que développeur, vous devrez fréquemment dupliquer du code. Voyons ensemble comment éviter cette répétition et réaliser cela efficacement, grâce aux fonctions ! 😃

# Découvrez les fonctions

Une **fonction** est un bloc de code auquel on attribue un nom. Appeler cette fonction permet d’exécuter le code qu’elle contient. On parle donc de fonction, car il s’agit d’un bloc de code qui a un rôle spécifique au sein de votre fichier JavaScript. Une fonction peut ainsi : 

- **contenir des informations**, qu’on appelle **paramètres** ;
- retourner un **résultat** ;
- effectuer une **action**. 

En fait, vous utilisez déjà des fonctions depuis le début de ce cours, sans même le savoir ! Par exemple, quand vous écrivez :

```
motUtilisateur = prompt('Entrez un mot')
```

_Prompt_ est une fonction : 

- elle prend en **paramètre** le message à afficher (ici, “Entrez un mot”) ;
- elle retourne un **résultat** : le mot tapé par l’utilisateur. 

Dans l’exemple ci-dessus, le retour de la fonction _prompt_ est copié dans _motUtilisateur_. 

# Rédigez une fonction en JavaScript

Dans le cadre de notre application, nous souhaitons écrire une fonction qui va **générer une phrase pour donner le score** final à l'utilisateur. Cette fonction prendra donc en paramètre deux informations : 

- le score ;
- le nombre de questions.

Elle retournera une phrase contenant ces informations.

Cela donne donc :

```
function retournerMessageScore(score, nombreQuestions) {
    let message = 'Votre score est de ' + score + ' sur ' + nombreQuestions
    return message
}
```

Revenons en détail sur ce morceau de code :

- le mot-clé **_function_** (“fonction”, en anglais) est suivi du nom “_retournerMessageScore_”. Ce mot est ici **obligatoire pour** **définir** la fonction, mais il n’est ensuite plus nécessaire lorsqu’on l’utilise ;
- par conséquent, la fonction “_retournerMessageScore_” est créée ;
- **entre parenthèses** sont indiqués les paramètres envoyés à cette fonction : “_score_” et “_nombreQuestions_” ;
- **entre accolades** est indiqué le bloc de code qui sera exécuté quand la fonction sera appelée (_let message…_ et _return_) ;
- dans ce bloc de code, nous déclarons **une variable** _**message**_ dans laquelle nous créons notre message ;
- le code est finalisé avec le nouveau mot-clé _**return**_. Ce mot signifie que la fonction va retourner le contenu de _message_.  

Si vous ajoutez ce code dans votre projet et que vous le testez, il ne provoquera aucun changement pour le moment. Ces instructions définissent notre fonction… Mais pour qu’elle produise son effet, nous devons **l’appeler**.

Par exemple :

```
let nouveauMessage = retournerMessageScore(5, 10)
console.log(nouveauMessage)
```

Gardez également en tête que l’**ordre des paramètres est très important** ! La fonction a un premier paramètre nommé “_score_” et un second paramètre nommé “_nombreQuestions_” : 

- si on appelle la fonction avec 5 et 10, 5 étant le premier paramètre, il ira donc dans la variable “_score_” ;
- le 10 étant positionné en second, il ira dans la variable “_nombreQuestions_”, positionnée en second aussi. 

[![Nom de la fonction, Liste des paramètres, corps de la fonction, liste des arguments, appel de la fonction, mots-clés returns et function.](https://user.oc-static.com/upload/2024/04/22/17137968473355_17013406089429_FR_%20Apprenez-a-programmer-avec-JavaScript_Static-Fixed.png)](https://user.oc-static.com/upload/2024/04/22/17137968473355_17013406089429_FR_%20Apprenez-a-programmer-avec-JavaScript_Static-Fixed.png)

Je vous propose de revoir cette opération dans la vidéo ci-dessous :

# Codez proprement

Vous vous rendrez compte très rapidement que les fonctions sont un élément majeur de votre code. Il est donc très important de **respecter quelques bonnes pratiques** pour prévenir tout problème. Voici quelques conseils.

## Définissez une tâche spécifique pour chaque fonction

Dans l’idéal, on attribue une seule tâche à une fonction : afficher, calculer, lancer une opération, initialiser… Si une fonction s’occupe de tout gérer à la fois, elle comportera beaucoup de lignes, difficiles à comprendre, à modifier et à tester.

## Écrivez des fonctions courtes

Dans l'idéal, vos fonctions ne doivent pas dépasser 30 lignes. Si le but de la fonction est clair, un code court est généralement suffisant pour l’atteindre.

Si la fonction prend trop d’ampleur, c’est peut-être qu’elle est mal conçue, qu’elle fait trop de choses, ou qu’il faudrait la découper en plusieurs sous-fonctions.

### Nommez clairement vos fonctions

Comme pour les variables, le nom d’une fonction devrait être suffisamment clair pour permettre d’en deviner le contenu sans lire le code qu’elle contient.

Vous pouvez par exemple utiliser un verbe pour nommer vos fonctions. Si une fonction s’appelle _resultat_, que fait-elle ? Elle calcule le résultat ? Elle l’affiche ? Elle le réinitialise ? En utilisant des noms tels que _afficherResultat_, _calculerResultat_, _reinitialiserResultat_… là, plus aucune ambiguïté ! 😃

### Nommez clairement vos paramètres

Les paramètres doivent également être le plus explicites possible :

```
lancerJeu(a) {
    // code
}
```

Que dois-je envoyer à ma fonction pour remplir le paramètre _a_ ? Est-ce qu’il représente le nom du joueur ? La liste des mots qu’il doit taper ? Autre chose ? 

Ici, est donc préférable d’écrire :

```
lancerJeu(listeMots) {
    // code
}
```

Rien qu’avec le nom, nous savons maintenant que le paramètre contient en réalité un tableau avec une liste de mots. N’oubliez pas non plus qu’en cas d'ambiguïté, vous pouvez toujours insérer un commentaire pour ajouter une précision !

# Organisez votre code en plusieurs fichiers

Découper votre code en plusieurs fonctions permet de mieux organiser vos idées et facilite les modifications, mais ce n’est pas suffisant…

Si votre projet continue de grandir, regrouper toutes vos fonctions au même endroit risque de rapidement causer des problèmes de lisibilité et de navigation. C’est encore plus vrai si vous êtes plusieurs à travailler sur le même projet !

Souvenez-vous, quand nous avons créé notre fichier index.HTML dans le chapitre "Appréhendez la logique de programmation", nous avons écrit :

```
<script src="script.js"></script>
```

… afin d’inclure notre fichier script.

Imaginez maintenant que nous voulions créer un fichier de configuration qui contiendrait nos deux tableaux _listeMots_ et _listePhrases_. Cela nous permettrait de faire évoluer ces tableaux sans risquer de modifier par erreur la logique du code ! 😃

Pour y parvenir, nous pouvons inclure ce nouveau fichier en insérant une nouvelle ligne dans le fichier HTML pour préciser le chemin du nouveau fichier :

```
<script src="config.js"></script>
<script src="script.js"></script>
```

Dans cet exemple, j’ai mis le fichier config.js avant script.js, car les variables que je vais définir dans le fichier config.js seront utilisées par script.js. ***Elles doivent donc être définies en premier.***

Ensuite, nous devons définir le contenu du fichier. Pour cela, nous allons supprimer les deux _const listeMots_ et _listesPhrases_ de script.js, et les copier  dans config.js.

```
// Liste des mots utilisés pour le jeu
const listeMots = ['Bonjour', 'Salut', 'Coucou']
const listePhrases = ['Bonjour, comment allez-vous ?', 'Salut, ça va ?', 'Coucou, ça va ?']
```

N'hésitez pas à ajouter des commentaires pour donner des précisions dans votre code. Mettre un commentaire inutile n’est pas très grave. En revanche, ne pas avoir un commentaire utile peut parfois faire perdre beaucoup de temps.

# Maîtrisez la portée des variables

Nous avons commencé à apprendre le JavaScript en déclarant des variables. Maintenant que vous manipulez des fonctions et des blocs de code, vous devez maîtriser une notion importante : la **portée des variables**. Pas de panique, je vous explique ! 😉

Les variables ont une **portée**, qui est définie par l’endroit où cette variable est déclarée. Ainsi, on distingue deux types de variables :  

- **les variables globales** : visibles et utilisables dans l’ensemble du code ;
- **les variables locales** : qui ne peuvent être utilisées qu’au sein du bloc de code dans lequel elles sont définies.

*Ouh là là là…  Aurais-tu un exemple pour rendre les choses plus claires ? 😱*

Bien sûr ! Prenons l’exemple ci-dessous :

```
let monNombre = 1
// monNombre est une variable globale, car elle est déclarée en dehors d’un bloc de code
function afficheUnNombre() {
    let monNombreLocal = 2
   // monNombreLocal est une variable locale, car déclarée uniquement au sein d’une fonction
    console.log("Intérieur de la fonction : ")
    console.log(monNombre) // monNombre est accessible
    console.log(monNombreLocal) // monNombreLocal est accessible
}
afficheUnNombre()
console.log("Extérieur de la fonction : ")
console.log(monNombre) // monNombre est accessible
console.log(monNombreLocal) // monNombreLocal n’est pas accesssible
```

Si vous copiez-collez ce code dans votre éditeur de code, vous constaterez plusieurs choses :

- les chiffres 1 et 2 apparaissent en premier : ils sont affichés dans la fonction _afficheUnNombre_ ;
- le dernier _console.log_ renvoie une erreur, due au fait que la variable _monNombreLocal_ est définie au sein du bloc de code de la fonction _afficheUnNombre_.

Comme il s’agit d’une variable locale, elle n’est pas accessible dans l’ensemble du code. Elle est donc inconnue lorsqu’on tente de l’afficher hors de la fonction qui la déclare.

À mesure que votre code s’agrandit, les variables s’accumulent. Certaines peuvent désigner le même élément, avoir le même nom… et provoquer des résultats inattendus 😱. En restreignant une variable à un bloc de code, vous l’empêchez d'interférer avec une autre variable globale. Cela vous évitera de nombreux bugs particulièrement difficiles à trouver !

# À vous de jouer !

## Étape 1 : découpez votre code en fonctions

Notre but est maintenant d’améliorer l’organisation et la lisibilité de [notre code](https://github.com/OpenClassrooms-Student-Center/7696886-javascript/tree/P2-C3---Les-boucles). Je vous propose donc de créer les fonctions suivantes : 

- _afficherResultat_ : cette fonction prend en paramètre le résultat et le nombre total de mots proposés, et affiche le résultat du joueur ; 
- _choisirPhrasesOuMots_ : cette fonction demande à l’utilisateur s’il veut jouer avec des phrases ou des mots. 

Tant que l’utilisateur n’a pas répondu “phrases” ou “mots”, la question lui est posée en boucle. La fonction ne prend aucun paramètre, mais retourne ce que l’utilisateur a répondu.

- _lancerBoucleDeJeu_ : cette fonction contient la boucle principale de jeu, c'est-à-dire la boucle _for_ qui propose les mots/phrases au joueur, et lui demande de taper ces mots. Elle prend en paramètre le tableau de mots/phrases qui sera proposé au joueur, et retourne le nombre de mots/phrases correctement tapés ;
- _lancerJeu_ : cette fonction sera la fonction principale, c’est elle qui s’occupe de lancer toutes les autres. En d’autres termes, c’est elle qui va appeler les fonctions que vous venez d’écrire. 

## Étape 2 : séparez votre code en plusieurs fichiers

- Séparez votre code en plusieurs fichiers.
- Créez un fichier config.js qui contiendra uniquement les deux listes de propositions.
- Créez un fichier main.js qui contiendra uniquement l’appel à la fonction principale _lancerJeu_.
- Vérifiez que tout fonctionne encore.
- Créez un nouveau répertoire appelé “scripts”, et placez-y tous vos fichiers.
- Vérifiez à nouveau votre code. 😃

Pour réussir cette étape, pensez bien à mettre à jour le fichier HTML !

## Corrigé

Vous pouvez vérifier votre travail en consultant [le corrigé](https://github.com/OpenClassrooms-Student-Center/7696886-javascript/tree/P2-C4---Les-fonctions).

# En résumé

- Une fonction est un morceau de code qui accomplit une tâche spécifique. L’utilisation de fonctions permet d’organiser son code en blocs fonctionnels.
- Pour créer une fonction en JavaScript, on utilise le mot-clé _function_ et on lui attribue un nom.
- On peut appeler une fonction en utilisant son nom, suivi de parenthèses  `()`  . Si la fonction comporte des paramètres, ceux-ci sont ajoutés entre les parenthèses. 
- Vous pouvez définir une valeur de retour que la fonction renvoie après son exécution. Cette valeur retournée par la fonction pourra alors être utilisée dans la suite du code. 
- Séparer son code en plusieurs fonctions et en plusieurs fichiers vous permet de mieux découper votre code, et donc de le rendre plus simple à comprendre.  
- Une variable déclarée dans un bloc de code n’est accessible que dans ce bloc de code.

_Et voilà, vous avez écrit votre premier fichier JavaScript, tout en découvrant des bonnes pratiques de code indispensables pour faire de vous un développeur JavaScript professionnel ! 🥳 Vous pouvez être fier de vous et vous préparer à la prochaine étape : faire interagir JavaScript avec votre page web ! Mais avant, je vous propose de tester ce que vous avez appris, grâce au quiz_.